# Documenta√ß√£o Swagger/OpenAPI

Este documento descreve como a documenta√ß√£o autom√°tica das APIs foi implementada usando Swagger/OpenAPI.

## üìö Acesso √† Documenta√ß√£o

### Clients API
- **URL**: http://localhost:3001/api/docs
- **Aplica√ß√£o**: Gerenciamento de Usu√°rios

### Transactions API
- **URL**: http://localhost:3002/api/docs
- **Aplica√ß√£o**: Gerenciamento de Transa√ß√µes

## üéØ Recursos do Swagger

### Interface Interativa

A documenta√ß√£o Swagger oferece:

- ‚úÖ **Visualiza√ß√£o de Endpoints**: Todos os endpoints organizados por tags
- ‚úÖ **Schemas de DTOs**: Estrutura completa dos objetos
- ‚úÖ **Try it Out**: Testar endpoints diretamente no navegador
- ‚úÖ **Exemplos**: Payloads de exemplo para cada endpoint
- ‚úÖ **Respostas**: C√≥digos HTTP e mensagens de erro
- ‚úÖ **Valida√ß√µes**: Regras de valida√ß√£o documentadas

### Funcionalidades

1. **Executar Requisi√ß√µes**: Teste APIs sem Postman/cURL
2. **Gerar C√≥digo Cliente**: Download de SDKs para v√°rias linguagens
3. **Exportar Spec**: OpenAPI JSON/YAML para ferramentas externas
4. **Persistir Autoriza√ß√£o**: Salva tokens entre requisi√ß√µes

## üîß Implementa√ß√£o

### Configura√ß√£o (main.ts)

#### Clients App

```typescript
import { DocumentBuilder, SwaggerModule } from '@nestjs/swagger';

const config = new DocumentBuilder()
  .setTitle('Loomi - Clients API')
  .setDescription('API para gerenciamento de clientes e usu√°rios')
  .setVersion('1.0')
  .addTag('users', 'Endpoints relacionados a usu√°rios')
  .addTag('clients', 'Endpoints relacionados ao servi√ßo de clientes')
  .build();

const document = SwaggerModule.createDocument(app, config);
SwaggerModule.setup('api/docs', app, document, {
  swaggerOptions: {
    persistAuthorization: true,
    tagsSorter: 'alpha',
    operationsSorter: 'alpha',
  },
});
```

#### Transactions App

```typescript
const config = new DocumentBuilder()
  .setTitle('Loomi - Transactions API')
  .setDescription('API para gerenciamento de transa√ß√µes financeiras')
  .setVersion('1.0')
  .addTag('transactions', 'Endpoints relacionados a transa√ß√µes financeiras')
  .build();
```

### Decorators Usados

#### DTOs

##### @ApiProperty (campos obrigat√≥rios)

```typescript
@ApiProperty({
  description: 'Nome completo do usu√°rio',
  example: 'Jo√£o Silva',
})
@IsString()
@IsNotEmpty()
name: string;
```

##### @ApiPropertyOptional (campos opcionais)

```typescript
@ApiPropertyOptional({
  description: 'Telefone do usu√°rio',
  example: '(11) 98765-4321',
  required: false,
})
@IsString()
@IsOptional()
phone?: string;
```

##### Enums

```typescript
@ApiProperty({
  description: 'Tipo de transa√ß√£o',
  enum: ['credit', 'debit', 'transfer'],
  example: 'credit',
})
@IsIn(['credit', 'debit', 'transfer'])
type: string;
```

#### Controllers

##### @ApiTags

```typescript
@ApiTags('users')
@Controller('api/users')
export class UsersController {}
```

##### @ApiOperation

```typescript
@ApiOperation({ 
  summary: 'Criar novo usu√°rio',
  description: 'Descri√ß√£o detalhada...'
})
@Post()
create() {}
```

##### @ApiResponse

```typescript
@ApiResponse({
  status: HttpStatus.CREATED,
  description: 'Usu√°rio criado com sucesso',
})
@ApiResponse({
  status: HttpStatus.BAD_REQUEST,
  description: 'Dados inv√°lidos',
})
```

##### @ApiParam

```typescript
@ApiParam({
  name: 'id',
  description: 'UUID do usu√°rio',
  example: '123e4567-e89b-12d3-a456-426614174000',
})
@Get(':id')
findOne(@Param('id') id: string) {}
```

##### @ApiBody

```typescript
@ApiBody({ type: CreateUserDto })
@Post()
create(@Body() dto: CreateUserDto) {}
```

## üìã Documenta√ß√£o por Endpoint

### Clients API

#### POST /api/users
- **Summary**: Criar novo usu√°rio
- **Body**: CreateUserDto (8 campos: name, email, cpf, etc.)
- **Responses**: 201 Created, 400 Bad Request

#### GET /api/users
- **Summary**: Listar todos os usu√°rios
- **Responses**: 200 OK
- **Note**: Cache habilitado

#### GET /api/users/:id
- **Summary**: Buscar usu√°rio por ID
- **Param**: id (UUID)
- **Responses**: 200 OK, 404 Not Found
- **Note**: Cache habilitado

#### PATCH /api/users/:id
- **Summary**: Atualizar usu√°rio
- **Param**: id (UUID)
- **Body**: UpdateUserDto (todos campos opcionais)
- **Responses**: 200 OK, 404 Not Found, 400 Bad Request
- **Note**: Emite evento RabbitMQ se dados banc√°rios mudarem

#### DELETE /api/users/:id
- **Summary**: Deletar usu√°rio
- **Param**: id (UUID)
- **Responses**: 200 OK, 404 Not Found

### Transactions API

#### POST /api/transactions
- **Summary**: Criar nova transa√ß√£o
- **Body**: CreateTransactionDto (amount, type, status, userId)
- **Responses**: 201 Created, 400 Bad Request

#### GET /api/transactions
- **Summary**: Listar todas as transa√ß√µes
- **Responses**: 200 OK

#### GET /api/transactions/:id
- **Summary**: Buscar transa√ß√£o por ID
- **Param**: id (UUID)
- **Responses**: 200 OK, 404 Not Found

#### GET /api/transactions/user/:userId
- **Summary**: Listar transa√ß√µes de um usu√°rio
- **Param**: userId (UUID)
- **Responses**: 200 OK, 404 Not Found

#### PATCH /api/transactions/:id
- **Summary**: Atualizar transa√ß√£o
- **Param**: id (UUID)
- **Body**: UpdateTransactionDto
- **Responses**: 200 OK, 404 Not Found, 400 Bad Request

#### DELETE /api/transactions/:id
- **Summary**: Deletar transa√ß√£o
- **Param**: id (UUID)
- **Responses**: 200 OK, 404 Not Found

## üöÄ Como Usar

### 1. Acessar a Documenta√ß√£o

```bash
# Iniciar aplica√ß√µes
npm run start:clients:dev
npm run start:transactions:dev

# Acessar no navegador
open http://localhost:3001/api/docs  # Clients
open http://localhost:3002/api/docs  # Transactions
```

### 2. Testar Endpoints

1. Abra a URL do Swagger no navegador
2. Expanda um endpoint (ex: POST /api/users)
3. Clique em "Try it out"
4. Preencha os campos (j√° vem com exemplos)
5. Clique em "Execute"
6. Veja a resposta abaixo

### 3. Visualizar Schemas

1. No Swagger UI, role at√© o final da p√°gina
2. Se√ß√£o "Schemas" mostra todos os DTOs
3. Clique em um schema para expandir
4. Veja todos os campos com:
   - Tipo de dado
   - Obrigat√≥rio/Opcional
   - Valida√ß√µes
   - Exemplos

### 4. Exportar Especifica√ß√£o

```bash
# OpenAPI JSON
curl http://localhost:3001/api/docs-json > clients-api.json
curl http://localhost:3002/api/docs-json > transactions-api.json

# OpenAPI YAML
curl http://localhost:3001/api/docs-yaml > clients-api.yaml
curl http://localhost:3002/api/docs-yaml > transactions-api.yaml
```

## üí° Exemplos de Uso

### Exemplo 1: Criar Usu√°rio via Swagger

1. Acesse http://localhost:3001/api/docs
2. Expanda `POST /api/users`
3. Clique "Try it out"
4. O payload de exemplo j√° est√° preenchido:
   ```json
   {
     "name": "Jo√£o Silva",
     "email": "joao.silva@example.com",
     "cpf": "123.456.789-00",
     "phone": "(11) 98765-4321"
   }
   ```
5. Clique "Execute"
6. Veja a resposta com status 201

### Exemplo 2: Buscar Transa√ß√µes

1. Acesse http://localhost:3002/api/docs
2. Expanda `GET /api/transactions`
3. Clique "Try it out"
4. Clique "Execute"
5. Veja a lista de transa√ß√µes

### Exemplo 3: Testar Valida√ß√µes

1. Acesse http://localhost:3002/api/docs
2. Expanda `POST /api/transactions`
3. Clique "Try it out"
4. Altere `amount` para `-50` (valor negativo)
5. Execute
6. Veja erro 400 com mensagem de valida√ß√£o

## üé® Personaliza√ß√µes

### Adicionar Autentica√ß√£o

```typescript
const config = new DocumentBuilder()
  .setTitle('Loomi - API')
  .addBearerAuth()
  .build();
```

No controller:
```typescript
@ApiBearerAuth()
@Controller('api/users')
export class UsersController {}
```

### Adicionar Servidor

```typescript
const config = new DocumentBuilder()
  .addServer('http://localhost:3001', 'Desenvolvimento')
  .addServer('https://api.loomi.com', 'Produ√ß√£o')
  .build();
```

### Adicionar Contato

```typescript
const config = new DocumentBuilder()
  .setContact('Equipe Loomi', 'https://loomi.com', 'contato@loomi.com')
  .setLicense('MIT', 'https://opensource.org/licenses/MIT')
  .build();
```

### Customizar UI

```typescript
SwaggerModule.setup('api/docs', app, document, {
  customSiteTitle: 'Loomi API Docs',
  customCss: '.swagger-ui .topbar { display: none }',
  swaggerOptions: {
    persistAuthorization: true,
    displayRequestDuration: true,
    filter: true,
    tagsSorter: 'alpha',
    operationsSorter: 'alpha',
  },
});
```

## üìä Schemas Documentados

### Clients API

#### CreateUserDto
- name: string (obrigat√≥rio)
- email: string (obrigat√≥rio, formato email)
- cpf: string (opcional)
- phone: string (opcional)
- address: string (opcional)
- city: string (opcional)
- state: string (opcional)
- zipCode: string (opcional)

#### UpdateUserDto
- Todos os campos opcionais
- Mesma estrutura do CreateUserDto

### Transactions API

#### CreateTransactionDto
- amount: number (obrigat√≥rio, positivo, m√°x 2 decimais)
- type: enum ['credit', 'debit', 'transfer'] (obrigat√≥rio)
- description: string (opcional)
- status: enum ['pending', 'completed', 'failed', 'cancelled'] (obrigat√≥rio)
- userId: string UUID (obrigat√≥rio)

#### UpdateTransactionDto
- Todos os campos opcionais
- Mesma valida√ß√£o do CreateTransactionDto

## üîç Vantagens do Swagger

### Para Desenvolvedores

1. ‚úÖ **Documenta√ß√£o Autom√°tica**: Atualizada automaticamente
2. ‚úÖ **Testes R√°pidos**: Sem precisar de Postman/Insomnia
3. ‚úÖ **Valida√ß√£o Visual**: Ver regras diretamente
4. ‚úÖ **Exemplos Prontos**: N√£o precisa criar payloads
5. ‚úÖ **Menos Erros**: Interface visual ajuda a evitar erros

### Para Equipe

1. ‚úÖ **Onboarding R√°pido**: Novos membros entendem a API
2. ‚úÖ **Contrato da API**: Spec compartilhada com frontend
3. ‚úÖ **Gera√ß√£o de SDKs**: Clientes autom√°ticos
4. ‚úÖ **Testes Manuais**: QA pode testar sem ferramentas externas
5. ‚úÖ **Documenta√ß√£o Sempre Atualizada**: Sincronizada com c√≥digo

### Para Integra√ß√µes

1. ‚úÖ **OpenAPI Spec**: Padr√£o da ind√∫stria
2. ‚úÖ **Importar em Ferramentas**: Postman, Insomnia, etc.
3. ‚úÖ **Code Generation**: Gerar clientes TypeScript, Java, Python, etc.
4. ‚úÖ **Mock Servers**: Criar mocks baseados na spec

## üõ†Ô∏è Gerando Clientes

### TypeScript/JavaScript

```bash
# Exportar spec
curl http://localhost:3001/api/docs-json > clients-api.json

# Usar openapi-generator
npx @openapitools/openapi-generator-cli generate \
  -i clients-api.json \
  -g typescript-axios \
  -o ./generated/clients-sdk
```

### Python

```bash
npx @openapitools/openapi-generator-cli generate \
  -i clients-api.json \
  -g python \
  -o ./generated/clients-python
```

### Java

```bash
npx @openapitools/openapi-generator-cli generate \
  -i clients-api.json \
  -g java \
  -o ./generated/clients-java
```

## üìù Melhores Pr√°ticas

### 1. Sempre Documentar

```typescript
// ‚ùå Sem documenta√ß√£o
@Get(':id')
findOne(@Param('id') id: string) {}

// ‚úÖ Com documenta√ß√£o
@Get(':id')
@ApiOperation({ summary: 'Buscar usu√°rio por ID' })
@ApiParam({ name: 'id', description: 'UUID do usu√°rio' })
@ApiResponse({ status: 200, description: 'Usu√°rio encontrado' })
findOne(@Param('id') id: string) {}
```

### 2. Usar Exemplos Realistas

```typescript
@ApiProperty({
  example: 'Jo√£o Silva', // ‚úÖ Exemplo realista
  // example: 'string',  // ‚ùå Exemplo gen√©rico
})
name: string;
```

### 3. Documentar Erros

```typescript
@ApiResponse({ status: 200, description: 'Sucesso' })
@ApiResponse({ status: 400, description: 'Dados inv√°lidos' })
@ApiResponse({ status: 404, description: 'N√£o encontrado' })
@ApiResponse({ status: 500, description: 'Erro do servidor' })
```

### 4. Usar Enums

```typescript
@ApiProperty({
  enum: ['credit', 'debit', 'transfer'],
  example: 'credit',
})
type: string;
```

### 5. Agrupar com Tags

```typescript
@ApiTags('users')       // Agrupa endpoints relacionados
@Controller('api/users')
export class UsersController {}
```

## üîó Integra√ß√µes

### Importar no Postman

1. Abra Postman
2. File > Import
3. Cole a URL: `http://localhost:3001/api/docs-json`
4. Clique Import
5. Todos os endpoints s√£o importados com exemplos

### Importar no Insomnia

1. Abra Insomnia
2. Create > Import from URL
3. Cole: `http://localhost:3001/api/docs-json`
4. Import

### Usar com Swagger Editor

1. Acesse: https://editor.swagger.io
2. File > Import URL
3. Cole: `http://localhost:3001/api/docs-json`
4. Editar e validar spec

## üìä Compara√ß√£o

| Ferramenta | Swagger UI | Postman | cURL |
|------------|-----------|---------|------|
| **Setup** | Nenhum | Download | Linha de comando |
| **Interface** | Web | Desktop/Web | Terminal |
| **Documenta√ß√£o** | ‚úÖ Autom√°tica | Manual | Nenhuma |
| **Exemplos** | ‚úÖ Inclusos | Manual | Manual |
| **Compartilhar** | ‚úÖ URL | Workspace | Scripts |
| **Valida√ß√£o** | ‚úÖ Visual | Sim | Manual |

## üéì Recursos Adicionados

### Clients API (/api/docs)

- 5 endpoints documentados
- 2 DTOs (CreateUserDto, UpdateUserDto)
- Tags: users, clients
- Exemplos brasileiros realistas
- Valida√ß√µes detalhadas
- C√≥digos de resposta HTTP

### Transactions API (/api/docs)

- 6 endpoints documentados
- 2 DTOs (CreateTransactionDto, UpdateTransactionDto)
- Tags: transactions
- Enums para type e status
- Valida√ß√µes de valores monet√°rios
- Exemplos de transa√ß√µes

## üîí Seguran√ßa

### Produ√ß√£o

Em produ√ß√£o, voc√™ pode:

1. **Desabilitar Swagger:**
   ```typescript
   if (process.env.NODE_ENV !== 'production') {
     SwaggerModule.setup('api/docs', app, document);
   }
   ```

2. **Proteger com Senha:**
   ```typescript
   app.use('/api/docs', basicAuth({
     users: { 'admin': 'senha123' },
     challenge: true,
   }));
   ```

3. **Usar API Key:**
   ```typescript
   .addApiKey({ type: 'apiKey', name: 'X-API-KEY', in: 'header' })
   ```

## üìö Refer√™ncias

- [NestJS Swagger](https://docs.nestjs.com/openapi/introduction)
- [OpenAPI Specification](https://swagger.io/specification/)
- [Swagger UI](https://swagger.io/tools/swagger-ui/)
- [OpenAPI Generator](https://openapi-generator.tech/)

## üí° Dicas

1. ‚úÖ Use `@ApiProperty` para todos os campos de DTOs
2. ‚úÖ Adicione exemplos realistas
3. ‚úÖ Document all status codes
4. ‚úÖ Use enums quando aplic√°vel
5. ‚úÖ Agrupe endpoints com tags
6. ‚úÖ Mantenha descri√ß√µes curtas e claras
7. ‚úÖ Teste a documenta√ß√£o regularmente
8. ‚úÖ Exporte spec para versionamento

